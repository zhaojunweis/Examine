<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.examine.dao.StudentMapper">

    <resultMap id="studentBaseMap" type="com.examine.domain.TStudent">
        <id property="id" column="id"/>
        <result property="sSno" column="s_sno"/>
        <result property="sName" column="s_name"/>
        <result property="sClassId" column="s_class_id"/>
        <result property="sScoreName" column="s_score_name"/>
        <result property="sIsDelete" column="s_is_delete"/>
    </resultMap>

    <select id="selectStudentPasswordByUsername" parameterType="String" resultType="String">
        select s_pass from t_student where s_sno=#{sSno}
    </select>

    <select id="selectIpAddressByUsername" parameterType="String" resultType="String">
        select s_login_address from t_submit where s_sno = #{sSno}
    </select>

    <select id="selectStudentEntityByUsername" parameterType="String" resultMap="studentBaseMap">
        select * from t_student where s_sno = #{sSno}
    </select>

    <update id="nonphysicalDeleteStudents">
        update t_student set s_is_delete = 1
    </update>

    <insert id="saveStudentOneByOne" parameterType="com.examine.domain.TStudent">
        insert
        into t_student(
           s_sno,
           s_name,
           s_class_id
        )values (
           #{sSno},
           #{sName},
           #{sClassId}
        )
    </insert>

    <!--考试人数-->
    <select id="examineesCount" resultType="Integer" parameterType="String">
        select count(*) from t_student where s_is_delete = 0 and s_score_name = #{sScoreName}
    </select>

    <!--登陆人数-->
    <select id="examineesWhoHasLoginCount" resultType="Integer" parameterType="String">
        select count(*) from t_submit where  s_is_delete = 0 and s_login_address IS NOT NULL and  exam_name = #{sScoreName}
    </select>

    <!--提交人数-->
    <select id="examineesWhoSubmitCount" resultType="Integer" parameterType="String">
        select count(*) from t_submit where s_is_submit = 1 and s_is_delete = 0 and  exam_name = #{sScoreName}
    </select>

    <!--未登录人数-->
    <select id="examineesWhoNoLoginCount" resultType="Integer" parameterType="String">
    select
      (
        select
          count(*)
           from t_student
        where
          s_is_delete = 0
           and
          s_score_name = #{sScoreName})
      -
      (
        select
          count(*)
            from t_submit
         where
          s_is_delete = 0
            and
          s_login_address IS NOT NULL
            and
          exam_name =  #{sScoreName}
      );
    </select>


    <insert id="insertStudent" parameterType="com.examine.domain.TStudent">
        insert
        into t_student(
           s_sno,
           s_name,
           s_class_id
        )values (
           #{sSno},
           #{sName},
           #{sClassId}
        )
    </insert>

    <insert id="updateDirtyData" parameterType="com.examine.domain.TStudent">
        update t_student
        <set>
            <if test="sSno != null">
                s_sno = #{sSno},
            </if>
            <if test="sName != null">
                s_name = #{sName},
            </if>
            <if test="sClassId != null">
                s_class_id = #{sClassId}
            </if>
        </set>
        where
        t_student.s_sno = 1610120001
    </insert>

    <update id="submitAnswer" parameterType="Map">
       update t_submit set s_is_submit = 1,s_exam_paper=#{examPaperUrl} where s_sno=#{sSno}
    </update>

    <select id="selectLoginInfoByIp" parameterType="String">

    </select>

</mapper>
