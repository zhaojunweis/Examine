<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8">
<title>上机考试系统</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<!-- le styles -->
<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/exam.css" rel="stylesheet">
<style>
body {
	padding-top: 60px;
	/* 60px to make the container go all the way to the bottom of the topbar */
}
</style>
<link href="css/bootstrap-responsive.css" rel="stylesheet">

</head>

<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<span class="brand"><strong>上机考试系统</strong></span>

				<ul class="nav navbar-nav">
					<li><a href="/admin_main"><i class="icon-home icon-white"></i>首页</a></li>
					<li><a href="/admin_teacher"><i class="icon-user icon-white"></i>教师管理</a></li>
					<li><a href="/admin_exam"><i class="icon-remove-circle icon-white"></i>考试清理</a></li>
					<li><a href="/admin_config"><i class="icon-wrench icon-white"></i>系统配置</a></li>
				</ul>
				<ul class="nav navbar-nav pull-right">
					<li><span  class="brand">欢迎您,</span><span class="brand" th:text="${session.tName}"><small></small></span></li>
					<li th:if="${session.tName!='admin'}"><a href="#" data-toggle="modal" data-target=".bs-example-modal-sm"><i class="icon-pencil icon-white"></i>修改口令</a></li>
					<li id="admin_logout"><a href="/logout"><i class="icon-share icon-white"></i>退出</a></li>
				</ul>

				<!--/.nav-collapse -->
			</div>
		</div>
	</div>

	<div class="modal fade bs-example-modal-sm span3" tabindex="-1" role="dialog"
		aria-labelledby="mySmallModalLabel">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">修改口令</h4>
				</div>
				<div class="modal-body">
				<form id="form_changepd" class="exam-form" action="admin_passwd" method="post">
					<p>
						<input type="password" name="oldpass" placeholder="原口令" style="width:100%"/>
						<br/>
						<input type="password" name="newpass1" placeholder="新口令" style="width:100%"/>
						<br/>
						<input type="password" name="newpass2" placeholder="重输新口令" style="width:100%"/>
						<br/>
						<input id="btn_changepd" type="button" class="btn btn-primary" value="修改" style="width:100%"/>
					</p>
				</form>
				</div>
			</div>
		</div>
	</div>

	<div class="container">

		<h1>
			<img src="img/exam-admin.png" /> 系统管理
		</h1>

		
			<div class="exam-alert">没有设置管理员帐号，默认管理员帐号存在安全风险，请尽快处理！</div>
			<br />
		


<form  id="form_config" class="exam-form form-horizontal" >
	<h4>修改系统配置</h4>
	<div class="control-group">
		<label class="control-label" for="interval">后台任务间隔时间</label>
		<div class="controls">
			<input type="text"   id="interval" name="sExamTime" value="30" onkeyup="value=value.replace(/[^\d]/g,'')"minlength="1" maxlength="4"  required/>
			<p class="help-block">指定扫描考试信息的间隔时间，单位为 分钟。</p>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label" for="pagesize">分页查询记录条数</label>
		<div class="controls">
			<input type="text" id="pagesize" name="sPageCount" value="30"  onkeyup="value=value.replace(/[^\d]/g,'')" minlength="1" maxlength="3"  required/>
			<p class="help-block">指定分页查询时每页显示记录数的默认值（查询页面中可以更改）。</p>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label" for="timegap">手动开启考试时间阈值</label>
		<div class="controls">
			<input type="text" id="timegap" name="manualOpenTime" value="15" onkeyup="value=value.replace(/[^\d]/g,'')" minlength="1" maxlength="4"  required/>
			<p class="help-block">指定手工开启考试时允许的最大提前量，单位为分钟</p>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label" for="minfilesize">上传文件字节数下限</label>
		<div class="controls">
			<input type="text" id="minfilesize" name="minUploadSize" value="512" onkeyup="value=value.replace(/[^\d]/g,'')"minlength="1" maxlength="10"  required />
			<p class="help-block">指定上传文件的长度下限（字节），低于此值发出警告</p>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label" for="maxfilesize">上传文件字节数上限</label>
		<div class="controls">
			<input type="text" id="maxfilesize" name="maxUploadSize" value="131072"  onkeyup="value=value.replace(/[^\d]/g,'')" minlength="1" maxlength="10"  required/>
			<p class="help-block">指定上传文件的长度上限（字节），高于此值发出警告</p>
		</div>
	</div>
	<div class="control-group">
		<div class="controls">
			<label class="checkbox">
			<input type="checkbox" id="candelete" name="sCanDelete" value="true"
				checked /> 教师可以清理和删除考试
			<!-- to make struts2 get unchecked input -->
		<!--	<input type="hidden" id="__checkbox_candelete" name="__checkbox_candelete" value="true" />-->
			</label>
		</div>
	</div>
	<div class="control-group">
		<div class="controls">
			<input id="btn_config" type="button"  class="btn btn-primary" value="修改" />
		</div>
	</div>
</form>


	</div>
	<!-- /container -->
	<!-- placed at the end of the document so the pages load faster -->
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery_validate/lib/jquery.js"></script>
	<script src="js/jquery_validate/dist/jquery.validate.min.js"></script>
	<script src="js/jquery_validate/dist/localization/messages_zh.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {

			$("#btn_config").click(function () {
			    debugger;
                /*$("#form_config").validate({
                    rules:{
                        sExamTime:{
                            required:true,
                        },
                        sPageCount:{
                            required:true,
                        },
                        manualOpenTime:{
                            required:true,
                        },
                        minUploadSize:{
                            required:true,
                        },
                        maxUploadSize:{
                            required:true,
                        },
                        sCanDelete:{
                            required:true,
                        }
                    },
                    messages:{
                        sExamTime:{
                            required:"请输入时间",
                        },
                        sPageCount:{
                            required:"请输入时间",
                        },
                        manualOpenTime:{
                            required:"请输入时间",
                        },
                        minUploadSize:{
                            required:"请输入时间",
                        },
                        maxUploadSize: {
                            required: "请输入时间",
                        },
                        sCanDelete:{
                            required:"请输入时间",
                        }
                    }
                });*/

                debugger;
                var path = "[[@{/}]]";
			    var data = $("#form_config").serialize();
			  	var status = $("input[name='sCanDelete']").val();
			  	var sCandelete;
			  	if(status=="true"){
			  	    sCandelete = 1;
				}else{
			  	    sCandelete = 0;
				}
				var sExamTime = $("input[name='sExamTime']").val();
                var sPageCount = $("input[name='sPageCount']").val();
                var manualOpenTime = $("input[name='manualOpenTime']").val();
                var minUploadSize = $("input[name='minUploadSize']").val();
                var maxUploadSize = $("input[name='maxUploadSize']").val();
                if((sExamTime=="")||(sPageCount=="")||(manualOpenTime=="")||(minUploadSize=="")||(maxUploadSize=="")){
                    alert("请完善设置信息");
				}else{
                    $.ajax({
                        type: 'post',
                        url: path+"systemconfig",
                        data:{
                            sExamTime:sExamTime,
                            sPageCount:sPageCount,
                            manualOpenTime:manualOpenTime,
                            minUploadSize:minUploadSize,
                            maxUploadSize:maxUploadSize,
                            sCanDelete:sCandelete,
                        },
                        success: function(data) {
                            var str = data.status;
                            if(str == 200){
                                alert(data.message);
                                debugger;
                                window.location.href = path+"admin_main";
                            }else{
                                alert("登录失败");
                            }
                        },
                        error:function (data) {
                            alert("未知错误，请稍后再试");
                        }
                    });

                }
				debugger;

            });
        });
	</script>
</body>
</html>
